# 基于元宇宙与数字孪生概念下的电子映射便携端应用开发

#### 姓名：陈永豪，聂雨荷，宫正

#### SID：11922203，11911839,12012803



## 1.Abstract (Project Objectives) 

In recent years, a concept  "Metaverse" has arisen. The Metaverse refers to a virtual world built by humans using digital technologies such as 5G, cloud computing, artificial intelligence, virtual reality, blockchain, and the Internet of Things. It is mapped or transcended by the real world, and can interact with the real world. It is a digital living space with a new social system. Among them, part of the content of the Metaverse emphasizes the changes between virtual and real. 

The concept of digital twins also emphasizes the two-way change between virtual and real. Therefore, how to complete the interaction between real to real, real to virtual, virtual to real, and virtual to virtual, especially how to synchronize the connection mapping between real to real and virtual to virtual, is a practical issue in the metacosmic boom. This topic aims to implement a program that can be applied to portable mobile terminals (such as a mobile app), which can enable multiple people to interact simultaneously in a map of a virtual world corresponding to reality: for example, generating a virtual object, or destroying virtual objects generated by other users; Or by detecting close contact between multiple users in the physical world and reacting the event to the virtual world.



## 2.**Background of engines and the reason why we chose Unity.**

Currently, 3D physics engines such as Unity and Unreal are widely used by developers for interactive digital twin applications, especially when it comes to MR related development requirements. In addition to having a complete set of development tools, such engines typically also have adaptations and interfaces for mobile and MR devices. The following will analyze the differences between Unity engine and Unreal engine and explain the reasons for selecting Unity engine for this project.

Unreal engine is the leading game and 3D physics engine on the current market. It has advantages such as high image quality and complete development tools. The Unreal engine is developed based on C++. Although development extensions for modules or languages such as. Net and Python have been added in recent years, its approach to using C++as the core base has not changed. This leads to relatively high difficulty in its development. At the same time, the Unreal engine itself has high requirements for computer performance

The Unity engine uses C # as its scripting language, and the editor has very complete property change and debugging functions for C # scripts. On the one hand, it reduces the complexity of programming and debugging, and on the other hand, .Net development based on C # has better support for hardware (Bluetooth, etc.). In addition, the Unity engine is more lightweight than Unreal, and although it is slightly insufficient in terms of high image quality development, it has almost no impact because image quality is not the focus of this project.



## 3.Progress

- Realistic 3D Model of Engineering College of South University of Science and Technology

- Using 'Bluetooth LE for IOS and Android' for indoor positioning of mobile terminals through Beacon Bluetooth beacons

- Mobile phone orientation acquisition

- The 'ARCore XR Plug in' under the Unity engine is deployed on the Android side, combining AR and Bluetooth signals for virtual spatial positioning

- Mobile AR Function Implementation

  

### **Description of model work**

The engineering school model used in this project is from the 3D model project of Southern University of Science and Technology. This project is an Unreal project, and the model is an FBX model file obtained after exporting assets through the UE engine. "When exporting a model in a UE project, the baking of materials requires the use of a source map file, which is not included in the project. Therefore, the materials obtained after export are all empty materials, that is, the model is a gray model.".

Although the gray mold has the disadvantage of being unattractive, due to the fact that art design is not the focus of this project, it will not be considered as the main work goal for the time being.



### Using 'Bluetooth LE for IOS and Android' for indoor positioning of mobile terminals through Beacon Bluetooth beacons

Firstly, install more than three Beacon Bluetooth beacons indoors for indoor positioning, and then the mobile device judges the relative distance to the beacon based on the received Bluetooth signal strength.

In the end, the indoor coordinates of the mobile terminal are obtained through a three-point positioning algorithm combined with the accurate coordinates of the beacon.

#### Trilateration

Ideally, given the distance from the current coordinate to the center of a 3 circle and the coordinates of the center of the circle, you can use it as a radius to find the intersection of the three circles to obtain the current coordinates
Take three nodes A, B, and C as the center of a circle, with coordinates of (Xa, Ya), (Xb, Yb), and (Xc, Yc). The three circles intersect at a point O. The intersection point O is the moving node, and A, B, and C are the reference nodes. The distances between A, B, and C and the intersection point O are da, dp, and dc, respectively. Assume that the coordinates of intersection D are (X, Y).



### Mobile phone orientation acquisition

Based on the requirements of the AR module and considering the low accuracy of GPS signals in indoor environments, we have chosen to use Bluetooth beacons and three-point positioning to determine the orientation of the mobile phone. However, Bluetooth beacons can only determine the three-dimensional coordinates of the phone, and cannot recognize the orientation of the phone. In order to more accurately identify the location and status of mobile phones, as well as to better assist in initializing and loading AR scenarios, we have decided to confirm the orientation of the phone by obtaining data from the phone compass.
Firstly, we send a request to call the phone compass sensor data to the Android mobile terminal using the Input. compass. enable() embedded in Unity. When the user allows the request, Unity can use the Input. compass class to call the data. There are three related data interfaces within it. Their differences are as follows:

- magneticHeading
  - The heading in degrees relative to the magnetic North Pole.  (Read Only)
- rawVector
  - The raw geomagnetic data measured in microteslas.  (Read Only)
- trueHeading
  - The heading in degrees relative to the geographic North Pole.  (Read Only)

Among them, magneticHeading and trueHeading return simple values, which are only the direction data we expect, and because magneticHeading uses the magnetic field strength, its reference is the North Magnetic Pole, which is more consistent with our usual definition of north direction, so we use magneticHeading as the data source.
Due to accuracy issues with mobile phone sensors, we will not directly use the data obtained in a single attempt for confirmation. In order to obtain more accurate numerical values, we chose two different processing methods. Both methods use an array to store magneticHeading data obtained continuously over a certain period of time. The first method usually sets the array length to be between 4 and 10, mainly reducing the impact of mutation data by removing a maximum and a minimum value and taking the mean. The second method usually uses a longer array length to store continuous data for a longer period of time and takes its mean as the result. Then, when new data is stored, the oldest data is deleted and updated in a sliding window like manner. The idea of this method is to dilute the impact of some erroneous data through a large amount of data. In this project, the actual selected value is 50.
Both methods can improve the accuracy of the obtained data, with the difference being that the former requires less data volume, which means its refresh interval is smaller and can provide more coherent feedback on the orientation of the phone. The latter has higher robustness and stronger anti-interference ability in normal situations, but the feedback speed is relatively slow because it requires a certain amount of time to fill the data array. At the same time, in extreme cases, such as when external forces cause the phone to rotate rapidly, the first method will obviously be due to the second method.



### ARCore

We plan to use ARCore to implement the outdoor and indoor AR navigation. We intend to integrate the point cloud model, the GPS signal and the 3D architecture model to solve this problem. We will deploy our navigation framework into an android mobile phone.



### Mobile AR Function Implementation

The AR Foundation package provides a set of SDKS for mobile AR. We mainly used the SDK to reproduce the following features in the interim.



#### Background Rendering

Calculate basic light estimation information from the camera frame. Provide information about the "Ambient Intensity", "Ambient Color", "Main Light Direction", "Main Light Intensity Lumens", "Main Light Color", and "Spherical Harmonics". It can be used to implement the virtual object is blocked by the real scene function.



#### Plane Detection and Masking

Detect the floor and wall in real environment. Provides collision, ray detection and other functions. Some devices are supported to classify planes into categories such as "door", "seat", "window", and "floor".  There is also a occlusion shader for the plane's material. This makes the plane appear invisible, but virtual objects behind the plane are culled. This provides an additional level of realism when, for example, placing objects on a table.

<img src="F:\qq\316061057\FileRecv\中期.assets\中期.assets\image-20230504110232823.png" alt="image-20230504110232823" style="zoom: 25%;" />

#### Image Tracking

The image tracking samples are supported on ARCore and ARKit. When detected the referenced image, mobile AR will generate a virtual object and paste it at a correct place with correct direction. You can assign different prefabs for each image in the reference image library.

<img src="F:\qq\316061057\FileRecv\中期.assets\中期.assets\image-20230504110213779.png" alt="image-20230504110213779" style="zoom: 25%;" />

#### Object Tracking

It detects a 3D object from a set of reference objects in an reference set. Perform almost the same function as Image Tracking.

#### Point Clouds

Detect and analyze the surrounding environment.  It can look up the stored point and update its position in the dictionary if it already exists.

#### Meshing

Some devices to construct meshes from scanned data of real world surfaces. With mesh classification enabled, each triangle in the mesh surface is identified as one of several surface types. This sample scene creates submeshes for each classification type and renders each mesh type with a different color. There are also functions that support rendering a depth texture on top of the scene based on the real world geometry. This allows for the real world to occlude virtual content.

<img src="F:\qq\316061057\FileRecv\中期.assets\中期.assets\image-20230504110315295.png" alt="image-20230504110315295" style="zoom: 25%;" />

#### Depth

- Environment depth (certain Android devices and Apple devices with the LiDAR sensor)
- Human stencil (Apple devices with an A12 bionic chip (or later) running iOS 13 or later)
- Human depth (Apple devices with an A12 bionic chip (or later) running iOS 13 or later)

<img src="F:\qq\316061057\FileRecv\中期.assets\中期.assets\image-20230504110137461.png" alt="image-20230504110137461" style="zoom: 25%;" />

## 4.Future work

- Slove some question about the version conflict and Android Compilation Issues
  - Some of the current features have conflicts with the Unity Editor version and issues with the Gradle in Android packaging, which need to be resolved in the next version

- Enrich AR interactive content
  - Having completed the basic functions of AR, it is necessary to enrich the interactive content in the scene

- Optimize Bluetooth positioning system
  - There are still some fluctuations in Bluetooth positioning, and it may be necessary to optimize the positioning algorithm to obtain more accurate coordinates
- Retrieve more useful information from phone (legal)